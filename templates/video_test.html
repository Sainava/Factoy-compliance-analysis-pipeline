<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Video Playback Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Direct Video Element</h3>
                <video id="directVideo" controls style="width: 100%; max-height: 300px;">
                    <source src="/outputs/test_h264/evidence/clip_TEST-H264.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            
            <div class="col-md-6">
                <h3>Dynamic Video Element</h3>
                <video id="dynamicVideo" controls style="width: 100%; max-height: 300px;">
                    Your browser does not support the video tag.
                </video>
                <br><br>
                <button class="btn btn-primary" onclick="loadVideo()">Load Video</button>
                <button class="btn btn-secondary" onclick="testPlayClip()">Test Play Clip Function</button>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Console Output</h3>
                <div id="console" class="border p-3" style="background-color: #f8f9fa; font-family: monospace;">
                    Console output will appear here...
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="testModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Test Video Modal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <video id="modalVideo" controls style="width: 100%; max-height: 400px;">
                        <source id="modalVideoSource" src="" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message) {
            const console = document.getElementById('console');
            console.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.scrollTop = console.scrollHeight;
            console.log(message);
        }

        function loadVideo() {
            const video = document.getElementById('dynamicVideo');
            const source = document.createElement('source');
            source.src = '/outputs/test_h264/evidence/clip_TEST-H264.mp4';
            source.type = 'video/mp4';
            
            // Clear existing sources
            video.innerHTML = '';
            video.appendChild(source);
            
            log('Loading video: ' + source.src);
            
            video.addEventListener('loadstart', () => log('Video loadstart event'));
            video.addEventListener('loadeddata', () => log('Video loadeddata event'));
            video.addEventListener('canplay', () => log('Video canplay event'));
            video.addEventListener('error', (e) => log('Video error: ' + e.message));
            
            video.load();
        }

        function testPlayClip() {
            const clipPath = '/outputs/test_h264/evidence/clip_TEST-H264.mp4';
            log('Testing playClip with: ' + clipPath);
            
            const modal = new bootstrap.Modal(document.getElementById('testModal'));
            const video = document.getElementById('modalVideo');
            const source = document.getElementById('modalVideoSource');
            
            // Set source
            source.src = clipPath;
            log('Set video source to: ' + source.src);
            
            // Add event listeners
            video.addEventListener('loadstart', () => log('Modal video loadstart'));
            video.addEventListener('loadeddata', () => log('Modal video loadeddata'));
            video.addEventListener('canplay', () => log('Modal video canplay'));
            video.addEventListener('error', (e) => log('Modal video error: ' + (e.message || 'Unknown error')));
            
            // Load and show modal
            video.load();
            modal.show();
        }

        // Test direct video events
        document.addEventListener('DOMContentLoaded', function() {
            const directVideo = document.getElementById('directVideo');
            directVideo.addEventListener('loadstart', () => log('Direct video loadstart'));
            directVideo.addEventListener('loadeddata', () => log('Direct video loadeddata'));
            directVideo.addEventListener('canplay', () => log('Direct video canplay'));
            directVideo.addEventListener('error', (e) => log('Direct video error: ' + (e.message || 'Unknown error')));
            
            log('Page loaded. Testing video playback...');
        });
    </script>
</body>
</html>